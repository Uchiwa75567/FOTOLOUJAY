<div class="settings-page">
  <app-navbar></app-navbar>

  <div class="container settings-container">
    <div class="settings-header">
      <div class="header-content">
        <h1>Paramètres du compte</h1>
        <p>Gérez vos informations personnelles et paramètres de sécurité</p>
      </div>
    </div>

    <!-- Success/Error Messages -->
    <div class="alert-container">
      <div *ngIf="successMessage" class="alert alert-success">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
          <polyline points="22 4 12 14.01 9 11.01"></polyline>
        </svg>
        <span>{{ successMessage }}</span>
      </div>
      <div *ngIf="errorMessage" class="alert alert-error">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
        <span>{{ errorMessage }}</span>
      </div>
    </div>

    <div class="settings-content">
      <!-- Profile Settings Card -->
      <div class="settings-card card">
        <div class="card-header">
          <div class="card-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          </div>
          <div class="card-title">
            <h2>Informations personnelles</h2>
            <p>Mettez à jour vos informations de profil</p>
          </div>
        </div>

        <div class="card-content">
          <form [formGroup]="profileForm" (ngSubmit)="onUpdateProfile()" class="settings-form">
            <div class="form-grid">
              <div class="form-group">
                <label for="email">Adresse email</label>
                <input
                  type="email"
                  id="email"
                  formControlName="email"
                  class="input"
                  [class.input-error]="profileFormControls['email'].invalid && profileFormControls['email'].touched"
                  placeholder="votre.email@example.com"
                >
                <div *ngIf="profileFormControls['email'].invalid && profileFormControls['email'].touched" class="error-text">
                  Adresse email invalide
                </div>
              </div>

              <div class="form-group">
                <label for="phone">Téléphone</label>
                <input
                  type="tel"
                  id="phone"
                  formControlName="phone"
                  class="input"
                  placeholder="+225 01 02 03 04 05"
                >
              </div>

              <div class="form-group form-group-full">
                <label for="address">Adresse</label>
                <textarea
                  id="address"
                  formControlName="address"
                  class="input textarea"
                  rows="3"
                  placeholder="Votre adresse complète"
                ></textarea>
              </div>
            </div>

            <div class="form-actions">
              <button
                type="submit"
                class="btn btn-primary"
                [disabled]="profileForm.invalid || loading"
              >
                <span *ngIf="loading" class="spinner spinner-small"></span>
                <svg *ngIf="!loading" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M19 21H5a2 2 0 0 1-2-2v-6a2 2 0 0 1 2-2h11l4 4h-3v3a2 2 0 0 1-2 2z"></path>
                  <polyline points="17 9 22 4 17 9"></polyline>
                  <path d="M22 4H9l4-4v9"></path>
                </svg>
                <span>Mettre à jour le profil</span>
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Password Settings Card -->
      <div class="settings-card card">
        <div class="card-header">
          <div class="card-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
              <circle cx="12" cy="16" r="1"></circle>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
            </svg>
          </div>
          <div class="card-title">
            <h2>Changer le mot de passe</h2>
            <p>Modifiez votre mot de passe pour sécuriser votre compte</p>
          </div>
        </div>

        <div class="card-content">
          <form [formGroup]="passwordForm" (ngSubmit)="onChangePassword()" class="settings-form">
            <div class="form-grid">
              <div class="form-group">
                <label for="currentPassword">Mot de passe actuel</label>
                <input
                  type="password"
                  id="currentPassword"
                  formControlName="currentPassword"
                  class="input"
                  [class.input-error]="passwordFormControls['currentPassword'].invalid && passwordFormControls['currentPassword'].touched"
                  placeholder="Votre mot de passe actuel"
                >
                <div *ngIf="passwordFormControls['currentPassword'].invalid && passwordFormControls['currentPassword'].touched" class="error-text">
                  Mot de passe actuel requis
                </div>
              </div>

              <div class="form-group">
                <label for="newPassword">Nouveau mot de passe</label>
                <input
                  type="password"
                  id="newPassword"
                  formControlName="newPassword"
                  class="input"
                  [class.input-error]="passwordFormControls['newPassword'].invalid && passwordFormControls['newPassword'].touched"
                  placeholder="Au moins 6 caractères"
                >
                <div *ngIf="passwordFormControls['newPassword'].invalid && passwordFormControls['newPassword'].touched" class="error-text">
                  Le mot de passe doit contenir au moins 6 caractères
                </div>
              </div>

              <div class="form-group">
                <label for="confirmPassword">Confirmer le nouveau mot de passe</label>
                <input
                  type="password"
                  id="confirmPassword"
                  formControlName="confirmPassword"
                  class="input"
                  [class.input-error]="passwordFormControls['confirmPassword'].errors?.['mismatch'] && passwordFormControls['confirmPassword'].touched"
                  placeholder="Confirmez votre nouveau mot de passe"
                >
                <div *ngIf="passwordFormControls['confirmPassword'].errors?.['mismatch'] && passwordFormControls['confirmPassword'].touched" class="error-text">
                  Les mots de passe ne correspondent pas
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button
                type="submit"
                class="btn btn-primary"
                [disabled]="passwordForm.invalid || loading"
              >
                <span *ngIf="loading" class="spinner spinner-small"></span>
                <svg *ngIf="!loading" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 12l2 2 4-4m6 2a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"></path>
                </svg>
                <span>Changer le mot de passe</span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
